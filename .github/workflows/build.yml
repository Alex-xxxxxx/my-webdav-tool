name: Build SmartWebDAV Exe

on:
  push:
    branches: [ "main", "master" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4  # å‡çº§åˆ° v4

    - name: Set up Python
      uses: actions/setup-python@v5 # å‡çº§åˆ° v5
      with:
        python-version: '3.10'

    - name: Debug - List Files
      run: |
        echo "=== File List ==="
        Get-ChildItem -Recurse | Select-Object FullName

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        # å³ä½¿æ²¡æœ‰ requirements.txt ä¹Ÿå¼ºåˆ¶å®‰è£…ä¾èµ–ï¼Œé˜²æ­¢æŠ¥é”™
        pip install flask requests pystray pillow pyinstaller

    - name: Build with PyInstaller
      run: |
        # è‡ªåŠ¨æŸ¥æ‰¾ä»“åº“é‡Œçš„ .py æ–‡ä»¶
        $pyFile = Get-ChildItem -Filter *.py | Select-Object -First 1
        
        if ($null -eq $pyFile) {
            Write-Error "âŒ Error: No .py file found!"
            exit 1
        }
        
        Write-Host "âœ… Building file: $($pyFile.Name)..."
        
        # å¼€å§‹æ‰“åŒ…
        pyinstaller --noconsole --onefile --hidden-import=pystray --name="SmartWebDAV" $pyFile.Name

    - name: Upload Artifact
      uses: actions/upload-artifact@v4  # ğŸ”¥ å…³é”®ä¿®å¤ï¼šå‡çº§åˆ° v4ï¼Œè§£å†³æŠ¥é”™
      with:
        name: SmartWebDAV-Windows-Exe
        path: dist/SmartWebDAV.exe
        compression-level: 0 # ä¸å‹ç¼©ï¼Œä¸Šä¼ æ›´å¿«
